# Gaussian Package v1.1 Specification

**Branch**: `feat/v1.1-events-facade-profile`  
**Issues**: #21, #22, #23, #24, #25, #26, #27  
**Status**: ðŸŸ¡ In Progress  
**Created**: 2025-12-07

---

## Overview

### Features (v1.1)
1. **Default On-chain Events** (#21) - Every sample emits an event
2. **Core Facade Module** (#22) - Single import point for public API  
3. **Profile Metadata Object** (#23) - On-chain version tracking

### Testing Improvements (v1.1)
4. **PDF Monotonic Test** (#24) - Dense grid test, 61 points [P1, 15min]
5. **PPF Fine-grained Fuzzing** (#25) - 100+ random probabilities [P1, 30min]
6. **Sampler Strict Monotonicity** (#26) - Strict `<` + randomized seeds [P1, 20min]
7. **Python Property Tests** (#27) - Hypothesis tests for PPF/CDF/sampler [P2, 45min]

---

## Implementation Order

| Order | Task | Issue | Time | Status |
|-------|------|-------|------|--------|
| 1 | Create CHANGELOG.md | - | 5 min | âœ… |
| 2 | Events module + integration | #21 | 30 min | ðŸŸ¡ |
| 3 | Core facade | #22 | 20 min | â¬œ |
| 4 | Profile module | #23 | 15 min | â¬œ |
| 5 | PDF dense test | #24 | 15 min | â¬œ |
| 6 | PPF fuzzing + sort helper | #25 | 30 min | â¬œ |
| 7 | Sampler strict test | #26 | 20 min | â¬œ |
| 8 | Python property tests | #27 | 45 min | â¬œ |
| 9 | Update docs, verify CHANGELOG | - | 20 min | â¬œ |

**Total**: ~3.5 hours

---

## Feature Details

### Feature 1: Events (`sources/events.move`)

```move
module gaussian::events {
    use sui::event;

    public struct GaussianSampleEvent has copy, drop {
        z_magnitude: u256,
        z_negative: bool,
        caller: address,
    }

    public struct NormalSampleEvent has copy, drop {
        z_magnitude: u256,
        z_negative: bool,
        mean: u256,
        std_dev: u256,
        value_magnitude: u256,
        value_negative: bool,
        caller: address,
    }

    public(package) fun emit_gaussian_sample(...) { event::emit(...) }
    public(package) fun emit_normal_sample(...) { event::emit(...) }
}
```

**Integrate into ALL sampling functions** (PPF + CLT).

### Feature 2: Core Facade (`sources/core.move`)

```move
module gaussian::core {
    public fun sample_z(r, ctx) -> SignedWad
    public fun sample_normal(r, mean, std, ctx) -> StandardNormal
    public fun cdf(z) -> u256
    public fun pdf(z) -> u256
    public fun ppf(p) -> SignedWad
    public fun erf(x) -> u256
    public fun erfc(x) -> u256
    public fun scale() -> u256
}
```

### Feature 3: Profile (`sources/profile.move`)

```move
module gaussian::profile {
    public struct GaussianProfile has key, store {
        id: UID,
        version: u32,        // 10100 = v1.1.0
        precision_class: u8, // 0 = standard
        max_z_wad: u256,     // 6e18
    }
    fun init(ctx) { /* create & share */ }
}
```

---

## Files Changed

| File | Action |
|------|--------|
| `CHANGELOG.md` | CREATE |
| `plans/v1.1-events-facade-profile.md` | CREATE |
| `sources/events.move` | CREATE |
| `sources/core.move` | CREATE |
| `sources/profile.move` | CREATE |
| `sources/sampling.move` | MODIFY |
| `tests/property_fuzz.move` | MODIFY |
| `scripts/src/06_property_tests.py` | MODIFY |
| `docs/API_REFERENCE.md` | MODIFY |

---

## Decisions Made

âœ… Changelog-first development  
âœ… CLT functions emit events  
âœ… Short names in facade  
âœ… Strict monotonicity tests  
âœ… P2 (#27) included in same release
