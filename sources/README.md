# Gaussian Library - Module Architecture

## Module Dependency Graph

```
                    ┌─────────────┐
                    │    core     │  ← Facade (single import point)
                    └─────┬───────┘
                          │
          ┌───────────────┼───────────────┐
          ▼               ▼               ▼
    ┌──────────┐   ┌─────────────┐   ┌─────────┐
    │ sampling │   │normal_forward│   │   erf   │
    └────┬─────┘   └──────┬──────┘   └────┬────┘
         │                │               │
         ▼                ▼               ▼
    ┌──────────┐   ┌─────────────┐   ┌───────────────┐
    │  events  │   │normal_inverse│   │erf_coefficients│
    └──────────┘   └──────┬──────┘   └───────────────┘
                          │
          ┌───────────────┼───────────────┐
          ▼               ▼               ▼
    ┌──────────┐   ┌─────────────┐   ┌──────────┐
    │signed_wad│   │ coefficients│   │   math   │
    └──────────┘   └─────────────┘   └──────────┘
```

## Module Categories

### User-Facing (Import These)

| Module | Purpose | Key Functions |
|--------|---------|---------------|
| **core.move** | Facade with short names | `sample_z`, `cdf`, `pdf`, `ppf`, `erf` |
| **sampling.move** | Random sampling | `sample_z`, `sample_normal`, `sample_standard_normal` |

### Mathematical Functions

| Module | Purpose | Key Functions |
|--------|---------|---------------|
| **normal_forward.move** | CDF Φ(z) and PDF φ(z) | `cdf_standard`, `pdf_standard` |
| **normal_inverse.move** | Inverse CDF Φ⁻¹(p) | `ppf`, `ppf_aaa` |
| **erf.move** | Error function | `erf`, `erfc`, `phi` |

### Infrastructure

| Module | Purpose | Key Types/Functions |
|--------|---------|---------------------|
| **events.move** | On-chain events | `GaussianSampleEvent`, `NormalSampleEvent` |
| **profile.move** | Version metadata | `GaussianProfile`, `version` |
| **signed_wad.move** | Signed fixed-point type | `SignedWad`, `add`, `sub`, `mul` |
| **math.move** | Low-level WAD arithmetic | `mul_div`, `div_scaled`, `signed_add` |

### Coefficients (Auto-generated)

| Module | Purpose | Generated By |
|--------|---------|--------------|
| **coefficients.move** | CDF/PDF/PPF rational approximation coefficients | `scripts/src/02_generate_coeffs.py` |
| **erf_coefficients.move** | erf rational approximation coefficients | `scripts/src/02_generate_coeffs.py` |

### Testing

| Module | Purpose |
|--------|---------|
| **harness.move** | Test utilities and fixtures |

## Import Patterns

### Recommended: Use the Facade

```move
use gaussian::core::{sample_z, cdf, pdf, ppf};
use gaussian::signed_wad::SignedWad;

public fun example(r: &Random, ctx: &mut TxContext) {
    let z = sample_z(r, ctx);
    let prob = cdf(&z);
}
```

### Advanced: Direct Module Access

```move
use gaussian::sampling;
use gaussian::normal_forward;
use gaussian::normal_inverse;
use gaussian::signed_wad::{Self, SignedWad};

public fun advanced_example(r: &Random, ctx: &mut TxContext) {
    // Full control over sampling method
    let (z_mag, z_neg) = sampling::sample_standard_normal_clt(r, ctx);
    
    // Build SignedWad manually
    let z = signed_wad::new(z_mag, z_neg);
    
    // Use forward/inverse functions
    let prob = normal_forward::cdf_standard(&z);
    let z_recovered = normal_inverse::ppf((prob as u128));
}
```

## File Naming Convention

All modules follow Sui Move conventions:
- **snake_case** file names: `normal_forward.move`
- **snake_case** module names: `gaussian::normal_forward`
- **PascalCase** struct names: `SignedWad`, `StandardNormal`
- **snake_case** function names: `cdf_standard`, `sample_z`
- **SCREAMING_SNAKE_CASE** constants: `SCALE`, `MAX_Z`
- **EPascalCase** error constants: `EInvalidStdDev`, `EDivisionByZero`

## Adding New Modules

1. Create `sources/new_module.move`
2. Add exports to `core.move` if user-facing
3. Update `docs/API_REFERENCE.md`
4. Add tests to the module or `tests/` directory

## Regenerating Coefficients

If you modify the approximation algorithms:

```bash
cd scripts
python src/02_generate_coeffs.py
```

This regenerates `coefficients.move` and `erf_coefficients.move`.
